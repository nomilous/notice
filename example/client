#!/usr/bin/env coffee

Notice = require '../lib/notice'

Notice.connect 'Client Name',
        
    connect:

        secret:      'â—Š'
        port:       10101
        transport: 'https'
    
    (error, notice) -> 

        throw error if error?

        #
        # assign middleware to process messages
        # -------------------------------------
        # 
        # * client has only one middleware pipeline
        # * messages define context.direction (in|out)
        #

        notice.use (msg, next) -> 

            if msg.context.title == 'reconnect'

                #
                # restart the example hub
                #

                msg.hello = 'Me again. I waited for your restart... :)'

            next()



        notice.use (msg, next) ->

            switch msg.context.direction

                when 'out' 

                    #
                    # something unique for hub to key clients
                    # ---------------------------------------
                    # 

                    msg.pid = process.pid
                    console.log 'SENDING: ', msg.context.title, msg

                    # ps. pid may not be the best option...

                when 'in'  then console.log 'RECEIVE:', msg.context.origin, msg


            next()

        #
        # send an event message
        #

        notice.event 'connect', hello: "i'm online"
