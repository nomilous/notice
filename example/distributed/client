#! /usr/bin/env coffee

notice = require '../../lib/notice'

TelevisionRemote = notice.client(

    messages: 

        channel: {}
        volume:  {}
        pause:   {}
        play:    {}
        ffwd:    {}

        vote:    {}
        impeach: 
            beforeCreate: -> 
                throw new Error 'democracy not configurable'

).create "Television Remote #{process.env.NAME}",

    context: 
        supremeAuthority: 'Mother' unless grandfather? || saturday?

    connect: 
        # address: 'localhost'
        allowUncertified: true # tolerate self sighned cert on serverside
        transport:       'https'
        port:             10101
        secret:           process.env.SECRET
        errorWait:        1000

    (error, client) -> 
    
        return console.log error if error?
        # console.log CLIENT: client

        #
        # capsules can be emitted with a promise
        #

        client.impeach().then(

            (m) -> console.log CAPSULE: m
            (e) -> console.log ERROR:   e

        )

        #
        # capsule can be emitted with a callback
        #

        client.play (err, res) -> 

            console.log()
            console.log 'visible capsule AFTER middleware', res
            console.log 'entire  capsule AFTER middleware', res.all


        client.channel 1, (err, res) -> 

            console.log()
            console.log 'visible capsule AFTER middleware', res
            console.log 'entire  capsule AFTER middleware', res.all

            res.channel = 2
            console.log 'capsule.channel cannot be changed': res
