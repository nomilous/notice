#! /usr/bin/env coffee

notice = require '../../lib/notice'

TelevisionRemote = notice.client(

    capsules: 

        channel: {}
        volume:  {}
        pause:   {}
        play:    {}
        ffwd:    {}

).create "Television Remote #{process.env.NAME}",

    context: 
        supremeAuthority: 'Mother' unless Grandfather? or Saturday?
        batteryLevel: 4 / 9

    connect: 
        adaptor:            'socket.io'
        url:                'https://localhost:10101'
        secret:             process.env.SECRET
        errorWait:          1000
        rejectUnauthorized: false # tolerate self sighned cert on serverside


        
        

    (error, client) -> 

        return console.log error if error?

        client.use 

            title: 'illustate .info'
            (next, capsule, traversal) -> 

                console.log next.info()
                next()


        client.use

            title: 'illustrate notifiying the message origin promise'
            (next, capsule, traversal) -> 

                if capsule._type == 'volume' then next.notify 'increasing now'
                # throw new Error 'error'
                next()

        client.volume( 'up', amount: 3 ).then(

            (capsule) -> console.log AFTER_ACK: capsule
            (error)   -> console.log ERROR: error
            (notify)  -> console.log NOTIFY: notify 

        )

