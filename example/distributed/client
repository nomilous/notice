#! /usr/bin/env coffee

notice = require '../../lib/notice'

TelevisionRemote = notice.client(

    capsules: 

        channel: {}
        volume:  {}
        pause:   {}
        play:    {}
        ffwd:    {}

).create "Television Remote #{process.env.NAME}",

    context: 
        supremeAuthority: 'Mother' unless Grandfather? || Saturday?

    connect: 
        address: 'localhost'
        transport:         'https'
        port:               10101
        secret:             process.env.SECRET
        errorWait:          1000
        rejectUnauthorized: false # tolerate self sighned cert on serverside


        
        

    (error, client) -> 

        return console.log error if error?

        client.use 

            title: 'illustate .info'
            (next, capsule) -> 

                #
                # a usefull idea: the next function has an info property
                # ------------------------------------------------------
                # 
                # * while writing code / tests to have a .info look upper
                # * this simply returns a link to the relevant doc, but
                #   much more could be done
                # * it will be necessary to explore ways to keep it's impact
                #   on the code speed/etc to a minimum
                # 

                console.log next.info
                next()


        client.use

            title: 'illustrate notifiying the message origin promise'
            (next, capsule) -> 

                if capsule._type == 'volume' then next.notify 'increasing now'
                # throw new Error 'error'
                next()

        client.volume( 'up', amount: 3 ).then(

            (capsule) -> 
            (error)   -> console.log ERROR: error
            (notify)  -> console.log NOTIFY: notify 

        )

