#! /usr/bin/env coffee

notice = require '../../lib/notice'

TelevisionRemote = notice.client(

    capsule: 

        channel: {}
        volume:  {}
        pause:   {}
        play:    {}
        ffwd:    {}

        uuid: -> 'override uuid generator'

).create "Television Remote #{process.env.NAME}",

    context: 
        supremeAuthority: 'Mother' unless Grandfather? or Saturday?
        batteryLevel: 4 / 9

    connect: 
        adaptor:            'socket.io'
        url:                'https://localhost:10101'
        secret:             process.env.SECRET
        errorWait:          1000
        rejectUnauthorized: false # tolerate self sighned cert on serverside


    (error, theRemote) -> 

        #
        # callback receives connected theRemote as a notifier,
        # or error
        #

        return console.log error if error?

        # theRemote.volume 'up', amount: 3, (err, capsule) -> 
    
        #     return console.log 'ERROR', err if err?
        #     # console.log capsule.all
        #     console.log capsule


        console.log theRemote


        theRemote.volume( 'up', amount: 3 ).then(

            (capsule) -> console.log 'Hub acknowledged', capsule._uuid
            (error)   -> console.log error
            (notify)  -> console.log 'Notify', notify 

                # 
                # => Notify { _type: 'control', control: 'transmitted', capsule: ...
                # 

        )