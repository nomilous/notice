#!/usr/bin/env coffee

Notice = require '../lib/notice'
    
Notice.listen 'Hub Name', 

    #
    # Configure with opts.listen
    # -------------------------- 
    # 
    #  * Using socket.io
    #  * PENDING: adaptor abstraction to enable transport plugins
    #

    listen:

        secret:   'â—Š'
        port:     10101
        address:  '0.0.0.0'
        cert:   __dirname + '/../cert/develop-cert.pem'
        key:    __dirname + '/../cert/develop-key.pem'


    #
    # Callback receives listening hub
    # -------------------------------
    # 
    # * hub is the interface to remote notifiers
    # * ... precise api design still in progress
    #

    (error, hub) -> 

        throw error if error?

        #
        # assign middleware to handle arriving messages
        #

        hub.use (msg, next) -> 

            console.log 'RECEIVE:', msg.context.origin, msg

            #
            # reply across the response pipeline
            #

            msg.context.responder.info 'title', hello: msg.context.origin
            next()

