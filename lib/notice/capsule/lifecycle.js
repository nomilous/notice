// Generated by CoffeeScript 1.6.3
var capsule, deferred;

deferred = require('also').deferred;

capsule = require('./capsule').capsule;

module.exports.lifecycle = function(type, config) {
  var local;
  if (config == null) {
    config = {};
  }
  return local = {
    cache: {},
    config: (function() {
      try {
        return config.capsule[type];
      } catch (_error) {}
    })(),
    Capsule: capsule(),
    create: deferred(function(_arg) {
      var cap, done, resolve;
      resolve = _arg.resolve;
      try {
        if (local.config.before) {
          cap = new local.Capsule;
          done = function() {
            return resolve(cap);
          };
          return local.config.before(done, cap);
        }
      } catch (_error) {}
      return resolve(new local.Capsule);
    })
  };
};
